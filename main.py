#!/usr/bin/env python3
"""
–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 1: –õ–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
–¥–ª—è –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
"""

from antlr4 import *
from AlgebraGrammarLexer import AlgebraGrammarLexer


def print_tokens(input_text):
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –≤—ã–≤–æ–¥–∏—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
    """
    print(f"\nüîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º: '{input_text}'")
    print("-" * 50)
    
    # –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ —Å—Ç—Ä–æ–∫–∏
    input_stream = InputStream(input_text)
    
    # –°–æ–∑–¥–∞–µ–º –ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
    lexer = AlgebraGrammarLexer(input_stream)
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–∫–µ–Ω—ã
    tokens = lexer.getAllTokens()
    
    # –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ (–∫—Ä–æ–º–µ EOF)
    if len(tokens) <= 1:
        print("–¢–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
        return
    
    print("–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã:")
    print("–¢–∏–ø —Ç–æ–∫–µ–Ω–∞       | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç—Ä–æ–∫–∞ | –ü–æ–∑–∏—Ü–∏—è")
    print("-" * 50)
    
    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ç–æ–∫–µ–Ω–∞–º (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ - EOF)
    for token in tokens[:-1]:
        # –ü–æ–ª—É—á–∞–µ–º —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è —Ç–æ–∫–µ–Ω–∞
        token_type = lexer.symbolicNames[token.type]
        token_text = token.text
        line = token.line
        column = token.column
        
        # –ö—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥
        print(f"{token_type:15} | {token_text:8} | {line:6} | {column:7}")


def run_tests():
    """
    –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
    """
    print("=" * 60)
    print("üß™ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –¢–ï–°–¢–´ –õ–ï–ö–°–ò–ß–ï–°–ö–û–ì–û –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê")
    print("=" * 60)
    
    # –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
    test_cases = [
        # –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
        "x + y",
        # –°–æ —Å—Ç–µ–ø–µ–Ω—è–º–∏
        "x^2 + y^3",
        # –° —É–º–Ω–æ–∂–µ–Ω–∏–µ–º –∏ –¥–µ–ª–µ–Ω–∏–µ–º
        "a * b / c",
        # –°–æ —Å–∫–æ–±–∫–∞–º–∏
        "(a + b) * c",
        # –ü–æ–ª–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ
        "x^2 + 3*x + 2 = 0",
        # –° –ø—Ä–æ–±–µ–ª–∞–º–∏ (–¥–æ–ª–∂–Ω—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è)
        "  a   +   b  ",
        # –°–ª–æ–∂–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
        "2*x^3 - 5*x^2 + 3*x - 7",
        # –î–µ–ª–µ–Ω–∏–µ
        "a / (b + c)",
        # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
        "a + b - c * d / e ^ f",
    ]
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã
    for i, test_expr in enumerate(test_cases, 1):
        print(f"\nüìù –¢–µ—Å—Ç {i}:")
        print_tokens(test_expr)


def interactive_mode():
    """
    –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –≤–≤–æ–¥–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π
    """
    print("\n" + "=" * 60)
    print("üíª –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú")
    print("=" * 60)
    print("–í–≤–æ–¥–∏—Ç–µ –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.")
    print("–ü—Ä–∏–º–µ—Ä—ã: 'x^2 + 1', 'a*b = c/d', '(x+y)^2'")
    print("–î–ª—è –≤—ã—Ö–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ 'exit' –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C")
    print("-" * 60)
    
    while True:
        try:
            # –ü–æ–ª—É—á–∞–µ–º –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_input = input("\n‚û°Ô∏è  –í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: ").strip()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã –≤—ã—Ö–æ–¥–∞
            if user_input.lower() in ['exit', 'quit', '–≤—ã—Ö–æ–¥']:
                print("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")
                break
            
            if not user_input:
                print("‚ö†Ô∏è  –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
                continue
            
            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
            print_tokens(user_input)
            
        except KeyboardInterrupt:
            print("\n\n–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            print("–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.")


def main():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
    """
    print("=" * 60)
    print("üéì –õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø –†–ê–ë–û–¢–ê ‚Ññ1")
    print("–õ–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π")
    print("=" * 60)
    print("–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:")
    print("  ‚Ä¢ –ß–∏—Å–ª–∞: 123, 45, 7")
    print("  ‚Ä¢ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: x, y, a, b, ...")
    print("  ‚Ä¢ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã: + - * / ^")
    print("  ‚Ä¢ –°—Ç–µ–ø–µ–Ω—å: x^2, a^b")
    print("  ‚Ä¢ –°–∫–æ–±–∫–∏: (a + b)")
    print("  ‚Ä¢ –£—Ä–∞–≤–Ω–µ–Ω–∏—è: expr = expr")
    print("=" * 60)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
    run_tests()
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    interactive_mode()
    
    print("\n" + "=" * 60)
    print("‚úÖ –õ–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω!")
    print("=" * 60)


if __name__ == "__main__":
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
    try:
        main()
    except ImportError:
        print("‚ùå –û–®–ò–ë–ö–ê: –õ–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!")
        print("\n–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:")
        print("1. –°–∫–∞—á–∞–π—Ç–µ antlr-4.13.1-complete.jar")
        print("2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:")
        print("   java -jar antlr-4.13.1-complete.jar -Dlanguage=Python3 AlgebraGrammar.g4")
        print("3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:")
        print("   pip install antlr4-python3-runtime")
