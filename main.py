#!/usr/bin/env python3
"""
–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 2: –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏ AST
–¥–ª—è –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
"""

import sys
from antlr4 import *
from AlgebraGrammarLexer import AlgebraGrammarLexer
from AlgebraGrammarParser import AlgebraGrammarParser
from ast_builder import ASTBuilder
from ast import PrintVisitor, EvaluateVisitor


def parse_expression(input_text):
    """
    –ü–∞—Ä—Å–∏—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å—Ç—Ä–æ–∏—Ç AST
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç AST –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    """
    print(f"\nüîç –ü–∞—Ä—Å–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: '{input_text}'")
    print("-" * 60)
    
    try:
        # –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ —Å—Ç—Ä–æ–∫–∏
        input_stream = InputStream(input_text)
        
        # –°–æ–∑–¥–∞–µ–º –ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
        lexer = AlgebraGrammarLexer(input_stream)
        
        # –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤
        token_stream = CommonTokenStream(lexer)
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—Å–µ—Ä
        parser = AlgebraGrammarParser(token_stream)
        
        # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–∑–±–æ—Ä —Å –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞
        tree = parser.start()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        if parser.getNumberOfSyntaxErrors() > 0:
            print("‚ùå –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞!")
            return None
        
        print("‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ")
        
        # –°—Ç—Ä–æ–∏–º AST
        builder = ASTBuilder()
        walker = ParseTreeWalker()
        walker.walk(builder, tree)
        
        ast = builder.get_ast()
        
        if ast:
            print("\nüå≥ –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –î–µ—Ä–µ–≤–æ (AST):")
            print("-" * 40)
            print(ast.to_string())
            
            # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥ —á–µ—Ä–µ–∑ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å
            print("\nüë£ –û–±—Ö–æ–¥ AST —á–µ—Ä–µ–∑ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å:")
            print("-" * 40)
            visitor = PrintVisitor()
            ast.accept(visitor)
            
            return ast
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å AST")
            return None
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return None


def evaluate_expression(ast, variables=None):
    """
    –í—ã—á–∏—Å–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
    """
    if variables is None:
        variables = {}
    
    try:
        visitor = EvaluateVisitor(variables)
        result = ast.accept(visitor)
        
        if isinstance(result, tuple):
            print(f"\nüßÆ –£—Ä–∞–≤–Ω–µ–Ω–∏–µ: –ª–µ–≤–∞—è —á–∞—Å—Ç—å = {result[0]}, –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å = {result[1]}")
        else:
            print(f"\nüßÆ –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è: {result}")
            
        return result
    except ValueError as e:
        print(f"\n‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å: {e}")
        return None


def test_parser():
    """
    –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
    """
    print("=" * 70)
    print("üß™ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –¢–ï–°–¢–´ –°–ò–ù–¢–ê–ö–°–ò–ß–ï–°–ö–û–ì–û –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê")
    print("=" * 70)
    
    test_cases = [
        # –ü—Ä–æ—Å—Ç—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        ("x + y", "–°–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö"),
        ("2 * 3", "–£–º–Ω–æ–∂–µ–Ω–∏–µ —á–∏—Å–µ–ª"),
        ("a^2", "–°—Ç–µ–ø–µ–Ω—å"),
        
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π
        ("2 + 3 * 4", "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞–¥ —Å–ª–æ–∂–µ–Ω–∏–µ–º"),
        ("(2 + 3) * 4", "–°–∫–æ–±–∫–∏ –∏–∑–º–µ–Ω—è—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç"),
        ("a * b + c / d", "–°–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"),
        
        # –£–Ω–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        ("-x", "–£–Ω–∞—Ä–Ω—ã–π –º–∏–Ω—É—Å"),
        ("+5", "–£–Ω–∞—Ä–Ω—ã–π –ø–ª—é—Å"),
        ("-2 * +3", "–£–Ω–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏"),
        
        # –£—Ä–∞–≤–Ω–µ–Ω–∏—è
        ("x = y", "–ü—Ä–æ—Å—Ç–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ"),
        ("a^2 + b^2 = c^2", "–¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞"),
        ("2*x + 3 = 7", "–õ–∏–Ω–µ–π–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ"),
        
        # –°–ª–æ–∂–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        ("(a + b) * (c - d)", "–°–∫–æ–±–∫–∏"),
        ("x^2 + 2*x + 1", "–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π —Ç—Ä–µ—Ö—á–ª–µ–Ω"),
        ("a / b * c / d", "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–ª–µ–Ω–∏—è –∏ —É–º–Ω–æ–∂–µ–Ω–∏—è"),
        
        # –°—Ç–µ–ø–µ–Ω–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
        ("2^3^2", "–°—Ç–µ–ø–µ–Ω—å —Å—Ç–µ–ø–µ–Ω–∏ (–ø—Ä–∞–≤–æ–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)"),
        ("a^b^c^d", "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–µ–ø–µ–Ω–∏"),
    ]
    
    results = []
    
    for i, (expr, description) in enumerate(test_cases, 1):
        print(f"\n{'='*50}")
        print(f"üìù –¢–µ—Å—Ç {i}: {description}")
        print(f"–í—ã—Ä–∞–∂–µ–Ω–∏–µ: {expr}")
        print(f"{'='*50}")
        
        ast = parse_expression(expr)
        
        if ast:
            # –ü—Ä–æ–±—É–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            if 'x' not in expr and 'y' not in expr and 'a' not in expr and 'b' not in expr and 'c' not in expr and 'd' not in expr:
                try:
                    evaluate_expression(ast)
                except:
                    pass
            
            results.append((expr, True, "–£—Å–ø–µ—à–Ω–æ"))
            print(f"‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù")
        else:
            results.append((expr, False, "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞"))
            print(f"‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù")
    
    return results


def interactive_mode():
    """
    –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –≤–≤–æ–¥–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π
    """
    print("\n" + "=" * 70)
    print("üíª –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú –ü–ê–†–°–ï–†–ê")
    print("=" * 70)
    print("–í–≤–æ–¥–∏—Ç–µ –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.")
    print("–ü—Ä–∏–º–µ—Ä—ã: 'x^2 + 1', 'a*b = c/d', '(x+y)^2'")
    print("–î–ª—è –≤—ã—Ö–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ 'exit' –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C")
    print("–î–ª—è –∑–∞–¥–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: 'x=5, y=3'")
    print("-" * 70)
    
    variables = {}
    
    while True:
        try:
            # –ü–æ–ª—É—á–∞–µ–º –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_input = input("\n‚û°Ô∏è  –í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: ").strip()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã –≤—ã—Ö–æ–¥–∞
            if user_input.lower() in ['exit', 'quit', '–≤—ã—Ö–æ–¥']:
                print("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")
                break
            
            if not user_input:
                print("‚ö†Ô∏è  –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–¥–∞–Ω–∏–µ –ª–∏ —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            if ',' in user_input and '=' in user_input:
                try:
                    parts = user_input.split(',')
                    for part in parts:
                        var_name, var_value = part.split('=')
                        var_name = var_name.strip()
                        var_value = float(var_value.strip())
                        variables[var_name] = var_value
                    print(f"‚úÖ –ó–∞–¥–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {variables}")
                    continue
                except:
                    print("‚ö†Ô∏è  –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–¥–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö")
                    continue
            
            # –ü–∞—Ä—Å–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
            ast = parse_expression(user_input)
            
            if ast:
                # –ü—Ä–æ–±—É–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å
                evaluate_expression(ast, variables)
            
        except KeyboardInterrupt:
            print("\n\n–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            print("–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.")


def validate_syntax():
    """
    –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
    """
    print("\n" + "=" * 70)
    print("üîç –í–ê–õ–ò–î–ê–¶–ò–Ø –°–ò–ù–¢–ê–ö–°–ò–ß–ï–°–ö–û–ô –ö–û–†–†–ï–ö–¢–ù–û–°–¢–ò")
    print("=" * 70)
    
    test_expressions = [
        ("2 + 3 * 4", True, "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ"),
        ("x + ", False, "–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ"),
        ("* 5", False, "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞"),
        ("(2 + 3", False, "–ù–µ–∑–∞–∫—Ä—ã—Ç–∞—è —Å–∫–æ–±–∫–∞"),
        ("2 + ) 3", False, "–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å–∫–æ–±–∫–∞"),
        ("2 ^^ 3", False, "–î–≤–æ–π–Ω–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä"),
        ("a = b = c", False, "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞"),
        ("2 + 3 * (4 - 1)", True, "–°–ª–æ–∂–Ω–æ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ"),
    ]
    
    for expr, should_pass, description in test_expressions:
        print(f"\n{'-'*50}")
        print(f"–¢–µ—Å—Ç: {description}")
        print(f"–í—ã—Ä–∞–∂–µ–Ω–∏–µ: '{expr}'")
        
        try:
            input_stream = InputStream(expr)
            lexer = AlgebraGrammarLexer(input_stream)
            token_stream = CommonTokenStream(lexer)
            parser = AlgebraGrammarParser(token_stream)
            tree = parser.start()
            
            errors = parser.getNumberOfSyntaxErrors()
            
            if errors == 0 and should_pass:
                print("‚úÖ –ö–û–†–†–ï–ö–¢–ù–û: –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤–µ—Ä–Ω—ã–π (–∫–∞–∫ –∏ –æ–∂–∏–¥–∞–ª–æ—Å—å)")
            elif errors > 0 and not should_pass:
                print("‚úÖ –ö–û–†–†–ï–ö–¢–ù–û: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (–∫–∞–∫ –∏ –æ–∂–∏–¥–∞–ª–æ—Å—å)")
            elif errors == 0 and not should_pass:
                print("‚ùå –û–®–ò–ë–ö–ê: –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞, –Ω–æ –ø–∞—Ä—Å–µ—Ä –ø—Ä–∏–Ω—è–ª –≤—ã—Ä–∞–∂–µ–Ω–∏–µ")
            else:
                print("‚ùå –û–®–ò–ë–ö–ê: –ù–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞, –Ω–æ –ø–∞—Ä—Å–µ—Ä –æ—Ç–∫–ª–æ–Ω–∏–ª –≤—ã—Ä–∞–∂–µ–Ω–∏–µ")
                
        except Exception as e:
            if not should_pass:
                print(f"‚úÖ –ö–û–†–†–ï–ö–¢–ù–û: –í—ã—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ —Å –æ—à–∏–±–∫–æ–π: {e}")
            else:
                print(f"‚ùå –û–®–ò–ë–ö–ê: –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")


def main():
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
    """
    print("=" * 70)
    print("üéì –õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø –†–ê–ë–û–¢–ê ‚Ññ2")
    print("–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ AST")
    print("=" * 70)
    print("–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞:")
    print("  ‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π: ^ > * / > + -")
    print("  ‚Ä¢ –£–Ω–∞—Ä–Ω—ã–µ + –∏ -")
    print("  ‚Ä¢ –°–∫–æ–±–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞")
    print("  ‚Ä¢ –£—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º =")
    print("  ‚Ä¢ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –¥–µ—Ä–µ–≤–∞ (AST)")
    print("  ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏")
    print("=" * 70)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
    test_results = test_parser()
    
    # –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ—Å—Ç–æ–≤
    print("\n" + "=" * 70)
    print("üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 70)
    
    passed = sum(1 for _, success, _ in test_results if success)
    total = len(test_results)
    
    print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {total}")
    print(f"–ü—Ä–æ–π–¥–µ–Ω–æ: {passed}")
    print(f"–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ: {total - passed}")
    print(f"–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: {passed/total*100:.1f}%")
    
    if total - passed > 0:
        print("\n–ù–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:")
        for expr, success, message in test_results:
            if not success:
                print(f"  ‚ùå '{expr}': {message}")
    
    # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    validate_syntax()
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    interactive_mode()
    
    print("\n" + "=" * 70)
    print("‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω!")
    print("‚úÖ AST —É—Å–ø–µ—à–Ω–æ —Å—Ç—Ä–æ–∏—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π!")
    print("=" * 70)


if __name__ == "__main__":
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
    try:
        from AlgebraGrammarParser import AlgebraGrammarParser
        main()
    except ImportError:
        print("‚ùå –û–®–ò–ë–ö–ê: –ü–∞—Ä—Å–µ—Ä –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!")
        print("\n–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:")
        print("1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ANTLR —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        print("2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:")
        print("   java -jar antlr-4.13.1-complete.jar -Dlanguage=Python3 AlgebraGrammar.g4")
        print("3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:")
        print("   pip install antlr4-python3-runtime")
